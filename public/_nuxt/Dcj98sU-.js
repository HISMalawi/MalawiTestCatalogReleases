import{_ as C}from"./eA2H0pyo.js";import{_ as E}from"./Cy6ejAbI.js";import{_ as L}from"./Bf0aH3QM.js";import{_ as V}from"./BgOZ5tY3.js";import{d as D,u as M,x as S,y as O,r as u,z as T,o as j,c as q,b as H,e as o,f as c,g as z,t as m,l}from"./DSPXqrpM.js";import{u as I}from"./BxMKpl0t.js";import{u as P}from"./CnpgD76R.js";import"./f4feb2ck.js";const Y={class:"min-h-screen bg-gray-50 p-5"},G={class:"mx-auto"},J={class:"bg-white rounded-lg border border-gray-100 overflow-hidden"},K={class:"w-full py-5 px-5 overflow-visible"},Q={class:"w-full space-y-4"},W={class:"bg-gray-50 p-4 rounded border border-gray-200"},X={class:"grid grid-cols-2 gap-4"},Z={class:"px-3 py-2 bg-white border border-gray-300 rounded text-gray-900"},k={class:"px-3 py-2 bg-white border border-gray-300 rounded text-gray-900"},ee={class:"px-3 py-2 bg-white border border-gray-300 rounded text-gray-900"},se={class:"px-3 py-2 bg-white border border-gray-300 rounded text-gray-900"},oe={class:"bg-blue-50 p-4 rounded border border-blue-200"},me=D({__name:"[id]",setup(te){I({title:"Update User | Malawi Test Catalog"});const{$metadata:p,$toast:n,$api:g}=M(),y=S(),f=O(),{canManageUsers:v}=P();v.value||(n.error("You don't have permission to edit users"),f.push("/app/users"));const i=u(!1),r=u(null),b=u([]),_=u([]),a=T({username:"",app_name:"",partner:"",location:"",password:"",password_confirmation:"",roles:[],id:0,created_at:"",updated_at:""}),x={fields:[{name:"roles",label:"Roles",rules:{required:!0}}]},h=async()=>{const s=y.params.id;if(s){i.value=!0;try{const e=await p.users.getById(Number(s));r.value=e,r.value!==null&&Object.keys(a).forEach(t=>{r.value&&t in r.value&&r.value[t]!==void 0&&t!=="password"&&t!=="password_confirmation"&&(t==="roles"&&Array.isArray(r.value[t])?a[t]=r.value[t].map(d=>typeof d=="string"?d:d.name):a[t]=r.value[t])})}catch{n.error("Failed to fetch user data"),setTimeout(()=>{f.push("/app/users")},3e3)}finally{i.value=!1}}},w=s=>s.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),A=async()=>{try{const s=await p.roles.getAll();s&&Array.isArray(s)&&(b.value=s.map(e=>{const t=typeof e=="string"?e:e.name||e.id;return{id:t,label:w(t)}}).filter(e=>e.id!=="system"&&e.id!=="admin"))}catch(s){console.error("Error fetching roles:",s),n.error("Failed to load roles")}},U=async()=>{try{const s=await g.get("users/locations/all");s&&Array.isArray(s)&&(_.value=s.map(e=>({id:e,label:e})))}catch(s){console.error("Error fetching locations:",s),n.error("Failed to load locations")}},R=s=>{const e=_.value.find(t=>t.id===s);return e?e.label:s},B=async(s,e)=>{if(!(!e||!r.value)){i.value=!0;try{const t={roles:a.roles};await p.users.update(r.value.id,t),n.success("User roles updated successfully"),setTimeout(()=>{f.push("/app/users")},2e3)}catch{n.error("An error occurred while updating user roles")}finally{i.value=!1}}};return j(()=>{A(),U(),h()}),(s,e)=>{const t=C,d=E,N=L,F=V;return H(),q("div",Y,[o("div",G,[o("div",J,[c(t,{icon:"mdi:account-edit-outline",title:"Update User",description:"Modify details of the user account"}),o("div",K,[c(F,{config:x,onSubmit:B},{default:z(({})=>[o("div",Q,[o("div",W,[e[5]||(e[5]=o("h3",{class:"text-sm font-medium text-gray-900 mb-3"},"User Information (Read-only)",-1)),o("div",X,[o("div",null,[e[1]||(e[1]=o("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Username",-1)),o("div",Z,m(l(a).username),1)]),o("div",null,[e[2]||(e[2]=o("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Full Name",-1)),o("div",k,m(l(a).app_name),1)]),o("div",null,[e[3]||(e[3]=o("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Partner",-1)),o("div",ee,m(l(a).partner),1)]),o("div",null,[e[4]||(e[4]=o("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Location",-1)),o("div",se,m(R(l(a).location)||"N/A"),1)])])]),o("div",oe,[e[6]||(e[6]=o("h3",{class:"text-sm font-medium text-gray-900 mb-3"},"Edit Roles",-1)),c(d,{name:"roles",label:"Roles",options:l(b),modelValue:l(a).roles,"onUpdate:modelValue":e[0]||(e[0]=$=>l(a).roles=$),"is-multiple":!0,placeholder:"Select roles",required:""},null,8,["options","modelValue"])])]),c(N,{class:"mt-4",label:"Update Roles",loading:l(i),type:"submit"},null,8,["loading"])]),_:1})])])])])}}});export{me as default};
