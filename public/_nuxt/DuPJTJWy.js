const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DaYWRK6B.js","./WCtLych_.js","./DSPXqrpM.js","./entry.Bz_mZM2O.css","./Cy6ejAbI.js","./BasicInformation.CJMDcRtg.css","./Cb9KKXQL.js","./Bcsf2iPY.js","./S7m0rBLI.js","./DCCyt2-k.js","./Bf0aH3QM.js","./BhFxkj3L.js","./CyCQu6eQ.js","./D41irIHb.js","./Bmpui9YA.js"])))=>i.map(i=>d[i]);
import{_ as G}from"./Bf0aH3QM.js";import{_ as Q}from"./BgOZ5tY3.js";import{u as X}from"./f4feb2ck.js";import{d as D,u as ee,r as h,p as V,w as z,K as te,v as P,b as _,g as re,e as v,c as x,F as H,A as se,C as K,q as R,i as ae,t as W,J as ne,l as T,_ as ie,z as Y,Y as E,Z as A}from"./DSPXqrpM.js";const oe={class:"stepper-container"},le={class:"flex items-center w-full p-3 space-x-2 text-sm font-medium text-center text-gray-500 bg-white dark:text-gray-400 sm:text-base dark:bg-gray-800 dark:border-gray-700 sm:p-4 sm:space-x-4 rtl:space-x-reverse"},ue=["onClick"],de={key:0,class:"w-5 h-5 text-white",xmlns:"http://www.w3.org/2000/svg",width:"1024",height:"1024",viewBox:"0 0 1024 1024"},ce={key:0,class:"w-3 h-3 ms-2 sm:ms-4 rtl:rotate-180","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 12 10"},me={class:"step-content p-5"},pe={class:"flex justify-between mt-6 p-5"},_e={key:1},fe=D({__name:"BaseStepper",props:{data:{type:Object,default:()=>({})},steps:{type:Array,required:!0,validator:d=>d.every(q=>"id"in q&&"title"in q)},initialStep:{type:Number,default:1},allowSkip:{type:Boolean,default:!1},stepStatuses:{type:Object,default:()=>({})},loadingComponent:{required:!1,type:Boolean},submitting:{required:!1,type:Boolean}},emits:["before-next-step","step-changed","submit","validate","validation-errors"],setup(d,{expose:q,emit:O}){const n=d,m=O,{$toast:w}=ee(),r=h(n.initialStep),f=h(new Set),y=h(new Set),S=V(()=>n.steps.find(e=>e.id===r.value)),{formValues:k,formErrors:F,isValid:M,validateForm:L}=X(S.value.validationSchema),B=async()=>L(k,S.value.validationSchema),j=(e,c)=>{n.steps.map(o=>o.id===e?(m("validate",{...o,filled:!0,valid:c}),{...o,filled:!0,valid:c}):o)},t=async()=>{if(r.value<n.steps.length){const e=B();if(j(r.value,(await e).valid),(await e).valid)U(r.value),r.value++;else if(!(await e).valid){J(r.value);const c=(g,a="")=>{Object.entries(g).forEach(([I,b])=>{const $=a?`${a}.${I}`:I;typeof b=="object"&&b!==null&&"message"in b?w.error(`${$.toString().replaceAll("_"," ")}: ${b.message}`):typeof b=="object"?c(b,$):w.error(`${$}: ${b}`)})},o=(await e).errors;c(o),m("validation-errors",o)}}},l=()=>{r.value>1&&(r.value--,m("step-changed",r.value))},i=e=>{s(e)&&(r.value=e,m("step-changed",r.value))},C=e=>{s(e)&&i(e)},s=e=>!!(n.allowSkip||e<r.value||e===r.value||e===r.value+1&&f.value.has(r.value)),u=e=>{for(const[c,o]of Object.entries(e)){const g=parseInt(c);o==="completed"||o==="success"?(f.value.add(g),y.value.delete(g)):o==="error"&&(y.value.add(g),f.value.delete(g))}},p=e=>{if(n.stepStatuses[e]){if(n.stepStatuses[e]==="error")return"error";if(n.stepStatuses[e]==="success"||n.stepStatuses[e]==="completed")return"success"}return y.value.has(e)?"error":f.value.has(e)?"success":"neutral"},U=e=>{f.value.add(e),y.value.delete(e)},J=e=>{y.value.add(e),f.value.delete(e)},Z=e=>{f.value.delete(e),y.value.delete(e)},N=e=>{m("submit",{data:e})};return z(()=>n.stepStatuses,e=>{u(e)},{deep:!0}),te("formContext",{stepValues:V(()=>k),formErrors:V(()=>F),isValid:V(()=>M),validateCurrentStep:B,onSubmitForm:N}),q({nextStep:t,prevStep:l,goToStep:i,markStepComplete:U,markStepError:J,resetStepStatus:Z,getStepStatus:p}),z(()=>n.data,e=>{e!=null&&e.test_type&&k&&Object.assign(k,{test_type_name:e.test_type.name,short_name:e.test_type.short_name,preferred_name:e.test_type.preferred_name,scientific_name:e.test_type.scientific_name,lonic_code:e.test_type.loinc_code,moh_code:e.test_type.moh_code,target_tat:e.test_type.targetTAT,iblis_mapping_name:e.test_type.iblis_mapping_name,test_category_id:e.test_type.test_category_id,can_be_done_on_sex:e.test_type.can_be_done_on_sex,specimen_types:e.specimen_types,measures:e.measures,organisms:e.organisms,lab_test_sites:e.lab_test_sites,assay_format:e.test_type.assay_format,hr_cadre_required:e.test_type.hr_cadre_required,equipment:e.equipment})},{deep:!0,immediate:!0}),(e,c)=>{const o=G,g=Q;return _(),P(g,{config:T(S).validationSchema,onSubmit:N},{default:re(()=>[v("div",oe,[v("ol",le,[(_(!0),x(H,null,se(d.steps,a=>(_(),x("li",{key:a.id,class:K(["flex items-center cursor-pointer",{"text-emerald-600":p(a.id)==="success","text-red-600":p(a.id)==="error","text-gray-500":p(a.id)==="neutral","cursor-not-allowed opacity-50":!s(a.id)}]),onClick:I=>C(a.id)},[v("span",{class:K(["flex items-center justify-center w-5 h-5 me-2 text-xs border rounded-full shrink-0",{"border-emerald-600 bg-emerald-600 text-white":p(a.id)==="success","border-red-600 bg-red-600 text-white":p(a.id)==="error","border-gray-500 bg-white text-gray-500":p(a.id)==="neutral"}])},[p(a.id)==="error"?(_(),x("svg",de,c[0]||(c[0]=[v("path",{fill:"currentColor",d:"M448 804a64 64 0 1 0 128 0a64 64 0 1 0-128 0m32-168h64c4.4 0 8-3.6 8-8V164c0-4.4-3.6-8-8-8h-64c-4.4 0-8 3.6-8 8v464c0 4.4 3.6 8 8 8"},null,-1)]))):(_(),x(H,{key:1},[ae(W(a.id),1)],64))],2),v("span",null,W(a.title),1),a.id<d.steps.length?(_(),x("svg",ce,c[1]||(c[1]=[v("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m7 9 4-4-4-4M1 9l4-4-4-4"},null,-1)]))):R("",!0)],10,ue))),128))]),v("div",me,[ne(e.$slots,"default",{currentStep:T(r)},void 0,!0)]),v("div",pe,[T(r)>1?(_(),x("button",{key:0,type:"button",onClick:l,class:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 focus:outline-none focus:ring-none focus:ring-gray-500 focus:ring-offset-2"}," Previous ")):(_(),x("div",_e)),T(r)<d.steps.length?(_(),P(o,{key:2,label:"Validate & Next",type:"button",onClick:t,class:"mr-2"})):R("",!0),T(r)===d.steps.length?(_(),P(o,{key:3,label:"Submit",type:"submit",loading:d.submitting},null,8,["loading"])):R("",!0)])])]),_:3},8,["config"])}}}),Se=ie(fe,[["__scopeId","data-v-9010770d"]]);function be(){const d=h(1),q=h(!1),O=h([]),n=h([]),m=Y({}),w=h({1:"neutral",2:"neutral",3:"neutral",4:"neutral",5:"neutral"}),r=Y(f());function f(){return{test_type:{name:"",short_name:"",description:"",loinc_code:"",moh_code:"",nlims_code:"",targetTAT:"",preferred_name:"",scientific_name:"",can_be_done_on_sex:"",test_category_id:0,id:0,prevalence_threshold:"",created_at:"",updated_at:"",assay_format:null,hr_cadre_required:null,iblis_mapping_name:null},specimen_types:[],measures:[y()],organisms:[],lab_test_sites:[],equipment:[]}}function y(){return{name:"",short_name:"",unit:"",measure_type_id:6,description:"",loinc_code:"",moh_code:"",nlims_code:"",preferred_name:"",scientific_name:"",measure_ranges_attributes:[]}}function S(t){if(typeof t!="object"||t===null)return t;if(Array.isArray(t))return t.map(i=>S(i));const l={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&t[i]!==null&&(l[i]=S(t[i]));return l}return{currentStep:d,loading:q,departments:O,measureTypes:n,testCatalog:r,stepStatuses:w,validationErrors:m,handleStepChange:t=>{d.value=t},getValidationErrors:t=>{Object.assign(m,t)},handleSpecimenUpdate:t=>{r.specimen_types=t},handleOrganismsUpdate:t=>{r.organisms=t},createEmptyMeasure:y,removeNullKeys:S,getSteps:()=>[{id:1,title:"Basic Information",component:E(()=>A(()=>import("./DaYWRK6B.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),props:{testCatalog:r,errors:m,departments:O.value.map(t=>({id:t.id,label:t.name}))},validationSchema:{fields:[{name:"test_type_name",label:"Test Type Name",rules:{required:!0}},{name:"short_name",label:"Short Name",rules:{required:!1}},{name:"preferred_name",label:"Preferred Name",rules:{required:!0}},{name:"scientific_name",label:"Scientific Name",rules:{required:!0}},{name:"target_tat",label:"Target TAT",rules:{required:!1}},{name:"iblis_mapping_name",label:"IBLIS Mapping Name",rules:{required:!1}},{name:"can_be_done_on_sex",label:"Can be done on sex",rules:{required:!0}},{name:"test_category_id",label:"Test Category",rules:{custom(t,l){return l.test_category_id===0?"Test category is required":!0}}}]},values:{test_type_name:""}},{id:2,title:"Specimens",component:E(()=>A(()=>import("./Cb9KKXQL.js"),__vite__mapDeps([6,7,2,3,8]),import.meta.url)),props:{data:r,errors:m},validationSchema:{fields:[{name:"specimen_types",label:"Specimen Types",rules:{required:!0}}]}},{id:3,title:"Measures",component:E(()=>A(()=>import("./DCCyt2-k.js"),__vite__mapDeps([9,1,2,3,10,4,11,12]),import.meta.url)),props:{initialTestCatalog:r,testCatalog:r,errors:m},validationSchema:{fields:[{name:"measures",label:"Measures",rules:{custom:t=>{if(t==null)return"";if(t.length===0)return"At least one measure must be added";if(!t.every(s=>s.name.trim()!==""))return"All measures must have a name";if(!t.every(s=>s.preferred_name.trim()!==""))return"Preferred name is required for all measures";if(!t.every(s=>s.scientific_name.trim()!==""))return"Scientific name is required for all measures";if(!t.every(s=>s.short_name.trim()!==""))return"All measures must have a short name";if(!t.every(s=>s.measure_type_id>0))return"All measures must have a measure type";const l=n.value.filter(s=>{var u,p;return((u=s.structure)==null?void 0:u.type)==="ranges"||((p=s.structure)==null?void 0:p.type)==="options"}),i=new Set(l.map(s=>s.id)),C=t.filter(s=>i.has(s.measure_type_id));if(C.length>0){if(C.some(s=>s.measure_ranges_attributes.length===0))return"Measures with range or option types require at least one range";if(C.some(s=>s.measure_ranges_attributes.some(u=>"range_lower"in u&&"range_upper"in u?u.range_lower===null||u.range_upper===null:"value"in u&&"interpretation"in u?u.value===null||u.interpretation===null:!1)))return"All measures require complete range values or option values with interpretations"}return!0}}}]}},{id:4,title:"Organisms",component:E(()=>A(()=>import("./D41irIHb.js"),__vite__mapDeps([13,7,2,3]),import.meta.url)),props:{testCatalog:r,selected:r.organisms},validationSchema:{fields:[]}},{id:5,title:"Others",component:E(()=>A(()=>import("./Bmpui9YA.js"),__vite__mapDeps([14,1,2,3,4]),import.meta.url)),props:{testCatalog:r,currentStep:d.value},validationSchema:{fields:[{name:"assay_format",label:"Assay Format",rules:{required:!1}},{name:"equipment",label:"Equipment Required",rules:{required:!1}},{name:"hr_cadre_required",label:"HR Cadre Required",rules:{required:!1}},{name:"lab_test_sites",label:"Lab Test Sites",rules:{required:!1}}]}}],prepareDataForSubmission:()=>{const t=JSON.parse(JSON.stringify(r));return t.test_type&&"id"in t.test_type&&delete t.test_type.id,t.measures&&t.measures.length>0&&t.measures.forEach(l=>{l.measure_ranges_attributes&&l.measure_ranges_attributes.length>0&&l.measure_ranges_attributes.forEach(i=>{"id"in i&&delete i.id})}),t}}}export{Se as _,be as u};
