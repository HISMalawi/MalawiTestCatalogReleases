import{_ as P}from"./D9xJQhiL.js";import{_ as Y}from"./fOVD2dkZ.js";import{_ as ee}from"./BXFRxcxa.js";import{_ as te}from"./NlL6ZmLo.js";import{d as F,r as C,u as I,j as M,c as h,b as _,F as A,f as s,k as o,g as f,e,i as H,y as O,t as u,m as q,J,w as se,o as oe,p as z,A as G}from"./PjMfiYHK.js";import{S as K,Y as Q,h as U,G as W,V as X}from"./C00CHmfA.js";import{D as ae}from"./BugC5oc-.js";import{d as ne}from"./BtSipvlV.js";import{u as le}from"./CWorKg9L.js";import"./Ste0I7My.js";import"./DmRZQY_I.js";import"./Cpj98o6Y.js";const ie={class:"fixed inset-0 overflow-y-auto"},re={class:"flex min-h-full items-center justify-center p-4 text-center"},ce={class:"mt-4 flex flex-col space-y-2.5"},de={class:"border rounded border-gray-200 p-4"},ue={class:"flex justify-between items-center mb-2"},me={class:"font-medium text-gray-800"},pe=["onClick"],fe={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},_e={class:"md:col-span-3"},ge={class:"md:col-span-3"},ve={class:"mt-6 flex justify-end space-x-3"},ye=F({__name:"ReleaseDialog",emits:["close","confirm"],setup(R,{emit:l}){const b=l,m=C(!1),{$toast:x}=I(),p=C({releaseNotes:[{title:"",description:"",changeType:null}]}),$={fields:[{name:"title",rules:{required:!0}},{name:"description",rules:{required:!0}},{name:"changeType",rules:{required:!0}}]},V=[{label:"Feature",id:"feature"},{label:"Enhancement",id:"enhancement"},{label:"Bug Fix",id:"bug-fix"},{label:"Security",id:"security"},{label:"Documentation",id:"documentation"},{label:"Performance",id:"performance"}],c=()=>{p.value.releaseNotes.push({title:"",description:"",changeType:null})},D=T=>{p.value.releaseNotes.length>1&&p.value.releaseNotes.splice(T,1)},k=()=>{p.value={releaseNotes:[{title:"",description:"",changeType:null}]}},i=(T,n,v)=>{if(v){x.error("Please fill in all required fields.");return}n&&(b("confirm",p.value),m.value=!1,k())};return(T,n)=>{const v=Y,B=M("Icon"),j=ee,t=P,a=te;return _(),h(A,null,[s(v,{label:"Release new version","icon-end":"fluent-mdl2:release-definition",onClick:n[0]||(n[0]=w=>m.value=!0)}),s(o(K),{appear:"",show:m.value,as:"template"},{default:f(()=>[s(o(Q),{as:"div",onClose:n[2]||(n[2]=w=>m.value=!1),class:"relative z-10"},{default:f(()=>[s(o(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:f(()=>n[3]||(n[3]=[e("div",{class:"fixed inset-0 bg-black/25"},null,-1)])),_:1}),e("div",ie,[e("div",re,[s(o(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:f(()=>[s(o(W),{class:"w-full max-w-2xl transform overflow-hidden rounded bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:f(()=>[s(o(X),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:f(()=>n[4]||(n[4]=[H(" Create New Release ")])),_:1}),s(a,{config:$,onSubmit:i},{default:f(({form:w})=>[e("div",ce,[e("div",de,[n[5]||(n[5]=e("h4",{class:"text-md font-medium text-gray-700 mb-3"}," Release Notes ",-1)),(_(!0),h(A,null,O(p.value.releaseNotes,(d,y)=>(_(),h("div",{key:y,class:"mb-4 p-3 border rounded border-gray-200 bg-gray-50"},[e("div",ue,[e("h5",me," Note #"+u(y+1),1),e("button",{onClick:g=>D(y),class:"text-red-500 hover:text-red-700 cursor-pointer",type:"button"},[s(B,{icon:"carbon:close-filled",class:"h-5 w-5"})],8,pe)]),e("div",fe,[e("div",_e,[s(j,{label:"Title",name:"title",modelValue:d.title,"onUpdate:modelValue":g=>d.title=g,placeholder:"Feature title",required:""},null,8,["modelValue","onUpdate:modelValue"])]),e("div",ge,[s(j,{label:"Description",name:"description",modelValue:d.description,"onUpdate:modelValue":g=>d.description=g,placeholder:"Describe the change...",type:"textarea",required:""},null,8,["modelValue","onUpdate:modelValue"])]),e("div",null,[s(t,{label:"Change Type",name:"changeType",modelValue:d.changeType,"onUpdate:modelValue":g=>d.changeType=g,options:V,required:""},null,8,["modelValue","onUpdate:modelValue"])])])]))),128)),s(v,{label:"Add Release Note","icon-start":"fluent-mdl2:add",onClick:c,class:"mt-3"})])]),e("div",ve,[s(v,{label:"Cancel",onClick:n[1]||(n[1]=d=>m.value=!1),appearance:"outline",kind:"neutral"}),s(v,{label:"Reset",appearance:"outline",kind:"neutral",onClick:k}),s(v,{label:"Create Release",appearance:"solid",kind:"brand",type:"submit"})])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])],64)}}}),he={class:"fixed inset-0 overflow-y-auto"},be={class:"flex min-h-full items-center justify-center p-4 text-center"},xe={class:"mt-4"},we={class:"text-gray-500"},Ce={key:0},$e={key:1},Ve={class:"mt-6 flex justify-end space-x-3"},Te=F({__name:"ConfirmReleaseDialog",props:{modelValue:{type:Boolean,default:!1},title:{default:"Confirm Release"},version:{default:""},customMessage:{default:""},confirmText:{default:"Release"},cancelText:{default:"Cancel"},confirmButtonColor:{default:"emerald"}},emits:["update:modelValue","confirm","cancel"],setup(R,{expose:l,emit:b}){const m=R,x=b,p=C(!1),{$api:$}=I(),V=q({get:()=>m.modelValue,set:i=>x("update:modelValue",i)}),c=()=>{V.value=!1},D=async()=>{p.value=!0,await $.post("approve_test_catalog",{version_details:m.version}).then(i=>{i&&x("confirm",i)}).catch(i=>{console.error(i)}).finally(()=>{p.value=!1,c()})},k=()=>{x("cancel"),c()};return l({isOpen:V,closeDialog:c}),(i,T)=>{const n=Y;return _(),J(o(K),{appear:"",show:V.value,as:"template"},{default:f(()=>[s(o(Q),{as:"div",onClose:c,class:"relative z-10"},{default:f(()=>[s(o(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:f(()=>T[0]||(T[0]=[e("div",{class:"fixed inset-0 bg-black/25"},null,-1)])),_:1}),e("div",he,[e("div",be,[s(o(U),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:f(()=>[s(o(W),{class:"w-full max-w-md transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:f(()=>[s(o(X),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:f(()=>[H(u(i.title),1)]),_:1}),e("div",xe,[e("p",we,[i.customMessage?(_(),h("span",Ce,u(i.customMessage),1)):(_(),h("span",$e," Are you sure you want to release version? This action cannot be undone. "))])]),e("div",Ve,[e("button",{type:"button",class:"inline-flex cursor-pointer justify-center rounded border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2",onClick:k},u(i.cancelText),1),s(n,{label:i.confirmText,onClick:D,loading:o(p)},null,8,["label","loading"])])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])}}}),ke={class:"w-full flex items-center space-x-3"},Re={class:"flex flex-col"},De={class:"text-3xl font-semibold text-black"},Ne={class:"text-gray-800 text-xl font-medium"},Be={class:"text-gray-500 text-sm font-light"},je=F({__name:"StatisticsCard",props:{data:{type:Object,required:!0}},setup(R){const l=R;return(b,m)=>{const x=M("Icon");return _(),h("div",{onClick:m[0]||(m[0]=p=>b.$router.push(l.data.route??"#")),class:"bg-white border border-gray-100 transition duration-150 cursor-pointer rounded p-6"},[e("div",ke,[s(x,{icon:l.data.icon,class:"text-black w-20 h-20"},null,8,["icon"]),e("div",Re,[e("p",De,u(l.data.count),1),e("p",Ne,u(l.data.title),1),e("p",Be,u(l.data.description),1)])])])}}}),Se={class:"min-h-screen bg-gray-50 p-5"},Ae={class:"w-full bg-white rounded border border-gray-100"},Ue={class:"rounded-t p-3 flex items-center space-x-2"},Fe={class:"w-full flex items-center justify-between p-4 border-b border-gray-200"},Oe={class:"flex items-center space-x-4"},qe={class:"p-4"},Ie={class:"flex items-center justify-between mb-4"},Me={class:"text-2xl font-semibold text-gray-800"},Ee={class:"flex items-center space-x-2"},Le={class:"px-3 py-1 bg-emerald-100 text-emerald-800 rounded-full text-sm font-medium"},ze={class:"px-3 py-1 bg-sky-100 text-sky-500 rounded-full text-sm font-medium"},Ge={class:"grid grid-cols-1 gap-6 mb-6 sm:grid-cols-2 lg:grid-cols-4"},Pe={class:"mb-6"},Ye={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},He={class:"flex items-start mb-2"},Je={class:"text-white text-lg font-medium"},Ke={class:"font-medium text-black text-lg"},Qe={class:"text-xs text-gray-500"},We={class:"text-base text-gray-500"},dt=F({__name:"index",setup(R){le({title:"Versions | Malawi Test Catalog"});const l=C({id:0,label:"click to select"}),b=C([]),{$api:m,$toast:x}=I(),p=C(!1),$=C(!1),V=C(),c=C(),D=t=>({1:"Current",2:"Stable",3:"Legacy",4:"Legacy",5:"Legacy"})[t]||"Unknown",k=q(()=>{var t,a,w,d,y,g,S,N;return[{title:"Specimens",count:((a=(t=c.value)==null?void 0:t.catalog)==null?void 0:a.specimen_types.length)||0,icon:"healthicons:microscope-with-specimen-outline",description:"Total number of specimens in the catalog"},{title:"Test Types",count:((d=(w=c.value)==null?void 0:w.catalog)==null?void 0:d.test_types.length)||0,icon:"healthicons:test-tubes-outline",description:"Total number of test types in the catalog"},{title:"Drugs",count:((g=(y=c.value)==null?void 0:y.catalog)==null?void 0:g.drugs.length)||0,icon:"healthicons:medicines-outline",description:"Total number of drugs in the catalog"},{title:"Organisms",count:((N=(S=c.value)==null?void 0:S.catalog)==null?void 0:N.organisms.length)||0,icon:"healthicons:virus-outline",description:"Total number of organisms in the catalog"}]}),i=t=>({feature:"bg-green-500",improvement:"bg-blue-500",bugfix:"bg-yellow-500",security:"bg-red-500"})[t]||"bg-gray-500",T=t=>({feature:"text-green-600",improvement:"text-blue-600",bugfix:"text-yellow-600",security:"text-red-600"})[t]||"text-gray-600",n=t=>{p.value=!1,$.value=!0,V.value=t},v=async t=>{try{const a=await m.get(`retrieve_test_catalog?version=${t}`);a&&(c.value=a)}catch(a){console.error("Error fetching catalog by version:",a)}},B=async()=>{try{const t=await m.get("retrieve_test_catalog_versions");t&&(b.value=t,l.value={id:t[0].id,label:t[0].version},v(t[0].version))}catch(t){console.error("Error fetching versions:",t)}},j=t=>{x.success(`Version ${t.version} released successfully!`),B()};return se(()=>l.value,t=>{if(t){const a=t,w=q(()=>{const d=b.value.find(y=>y.id===a);return d?d.version:"Unknown"});v(w.value)}},{deep:!0}),oe(()=>{B()}),(t,a)=>{var N,E,L;const w=M("Icon"),d=P,y=ye,g=Te,S=je;return _(),h("div",Se,[e("div",Ae,[e("div",Ue,[s(w,{icon:"devicon-plain:git",class:"w-6 h-6 text-black"}),a[2]||(a[2]=e("h1",{class:"text-3xl font-semibold text-black"},"Versions",-1))]),e("div",Fe,[e("div",null,[s(d,{name:"versions-dropdown",options:o(b).map(r=>({id:r.id,label:r.version})),modelValue:o(l),"onUpdate:modelValue":a[0]||(a[0]=r=>z(l)?l.value=r:null),label:"Select version"},null,8,["options","modelValue"])]),e("div",Oe,[s(y,{onConfirm:n})]),s(g,{modelValue:o($),"onUpdate:modelValue":a[1]||(a[1]=r=>z($)?$.value=r:null),version:o(V),onConfirm:j},null,8,["modelValue","version"])]),e("div",qe,[e("div",Ie,[e("h2",Me," Version "+u((N=o(c))==null?void 0:N.version),1),e("div",Ee,[e("span",Le," Released: "+u(o(ne)((E=o(c))==null?void 0:E.created_at).format("DATE_FORMAT"in t?t.DATE_FORMAT:o(ae))),1),e("span",ze,u(D(o(l).id)),1)])]),e("div",Ge,[(_(!0),h(A,null,O(o(k),r=>(_(),J(S,{data:r},null,8,["data"]))),256))]),e("div",Pe,[a[3]||(a[3]=e("h3",{class:"text-xl font-semibold mb-3"},"Changelog",-1)),e("div",Ye,[(_(!0),h(A,null,O((L=o(c))==null?void 0:L.version_details.releaseNotes,(r,Z)=>(_(),h("div",{key:Z,class:"p-4 bg-white border rounded border-gray-200"},[e("div",He,[e("div",{class:G(["rounded-full justify-center mr-3 w-8 h-8 flex items-center",i(r.changeType)])},[e("span",Je,u(r.changeType.charAt(0).toUpperCase()),1)],2),e("div",null,[e("h4",Ke,u(r.title),1),e("span",Qe,u(r.created_at),1)])]),e("p",We,u(r.description),1),e("div",{class:G(["mt-3 text-xs font-medium",T(r.changeType)])},u(r.changeType),3)]))),128))])])])])])}}});export{dt as default};
