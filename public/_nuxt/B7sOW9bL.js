import{_ as L}from"./B-WsDPk8.js";import{_ as J}from"./Bcsf2iPY.js";import{d as w}from"./BtSipvlV.js";import{_ as Q}from"./Bf0aH3QM.js";import{d as M,r,p as E,v as W,b,g as d,f as l,l as t,e as a,i as j,t as B,u as X,j as Z,o as ee,k as R,c as C,q as T,s as $,C as te}from"./DSPXqrpM.js";import{Y as ae,h as N,G as se,V as oe,S as le}from"./BhFxkj3L.js";import{u as ne}from"./BxMKpl0t.js";import{u as re}from"./CnpgD76R.js";import{D as k}from"./BugC5oc-.js";import"./Cpj98o6Y.js";import"./CyCQu6eQ.js";const ie={class:"fixed inset-0 overflow-y-auto"},ce={class:"flex min-h-full items-center justify-center p-4 text-center"},de={class:"mt-4"},ue={class:"text-gray-500"},me={class:"mt-6 flex justify-end space-x-3"},pe=M({__name:"UserStatusDialog",props:{modelValue:{type:Boolean,default:!1},title:{default:"Confirm Action"},message:{default:"Are you sure you want to proceed?"},confirmButtonText:{default:"Confirm"},confirmButtonKind:{default:"brand"}},emits:["update:modelValue","confirm","cancel"],setup(U,{expose:y,emit:f}){const x=U,i=f,m=r(!1),c=E({get:()=>x.modelValue,set:o=>i("update:modelValue",o)}),u=()=>{c.value=!1},A=async()=>{i("confirm")},g=()=>{i("cancel"),u()};return y({isOpen:c,closeDialog:u,setLoading:o=>{m.value=o}}),(o,p)=>{const _=Q;return b(),W(t(le),{appear:"",show:c.value,as:"template"},{default:d(()=>[l(t(ae),{as:"div",onClose:u,class:"relative z-50"},{default:d(()=>[l(t(N),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:d(()=>p[0]||(p[0]=[a("div",{class:"fixed inset-0 bg-black/25"},null,-1)])),_:1}),a("div",ie,[a("div",ce,[l(t(N),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:d(()=>[l(t(se),{class:"w-full max-w-md transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:d(()=>[l(t(oe),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:d(()=>[j(B(o.title),1)]),_:1}),a("div",de,[a("p",ue,B(o.message),1)]),a("div",me,[a("button",{type:"button",class:"inline-flex cursor-pointer justify-center rounded border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2",onClick:g}," Cancel "),l(_,{type:"button",label:o.confirmButtonText,onClick:A,loading:t(m),kind:o.confirmButtonKind},null,8,["label","loading","kind"])])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])}}}),fe={class:"px-4 py-8"},ge={class:"w-full flex items-center justify-between bg-white border border-gray-100 rounded my-2 px-4 py-2"},ve={class:"w-full flex items-center justify-between"},be={class:"flex items-center space-x-4"},ye={class:"max-w-md w-full"},xe={class:"mt-5"},_e={class:"flex items-center space-x-3"},he=["onClick"],we=["onClick","title"],Re=M({__name:"index",setup(U){ne({title:"Users | Malawi Test Catalog"});const{$metadata:y,$toast:f}=X(),x=Z(),{canManageUsers:i}=re();i.value||(f.error("You don't have permission to access user management"),x.push("/app"));const m=r(!1),c=r(""),u=r([]),A=[{text:"USERNAME",value:"username"},{text:"NAME",value:"app_name"},{text:"PARTNER",value:"partner"},{text:"DATE CREATED",value:"created_at"},{text:"ACTIONS",value:"actions"}],g=r([]),o=r(!1),p=r(""),_=r(""),D=r(""),S=r("brand"),h=r(null),O=E(()=>g.value.map(e=>({...e,created_at:w(e.created_at).format(k)}))),I=E(()=>({name:`malawi-test-catalog-users-${w().format(k)}`,headers:["Malawi Test Catalog Users","Report Date: "+w().format(k)],data:g.value.map(e=>({USERNAME:e.username,NAME:e.app_name,PARTNER:e.partner,"CREATED AT":w(e.created_at).format(k)}))})),V=async()=>{m.value=!0;try{const e=await y.users.getAll();e&&(g.value=e)}catch(e){console.error(e)}finally{m.value=!1}},K=e=>{console.log("Toggle user status clicked for user:",e),h.value=e;const s=e.disabled?"enable":"disable";p.value=e.disabled?"Enable User":"Disable User",_.value=e.disabled?`Are you sure you want to enable ${e.username}? They will be able to access the system again.`:`Are you sure you want to disable ${e.username}? They will not be able to access the system.`,D.value=s.charAt(0).toUpperCase()+s.slice(1),S.value=e.disabled?"brand":"danger",console.log("Opening dialog with title:",p.value),o.value=!0},Y=async()=>{if(!h.value)return;const e=h.value,s=e.disabled?"enable":"disable";try{await y.users.toggleStatus(e.id,{disabled:!e.disabled}),f.success(`User ${s}d successfully`),o.value=!1,await V()}catch(v){f.error(`Failed to ${s} user`),console.error(v)}},z=()=>{h.value=null,o.value=!1},F=e=>{x.push(`/app/users/update/${e.id}`)};return ee(()=>{V()}),(e,s)=>{const v=R("Icon"),G=L,P=J,q=R("datatable");return b(),C("div",fe,[s[6]||(s[6]=a("div",null,[a("h1",{class:"text-3xl font-semibold py-4"},"Users")],-1)),a("div",ge,[a("div",ve,[a("div",be,[t(i)?(b(),C("button",{key:0,onClick:s[0]||(s[0]=n=>e.$router.push("/app/users/create")),class:"cursor-pointer bg-emerald-600 hover:bg-emerald-700 transition duration-150 flex items-center text-emerald-100 px-2.5 py-2 rounded"},[l(v,{icon:"mdi:plus",class:"w-5 h-5 mr-1"}),s[4]||(s[4]=j(" Add new "))])):T("",!0),l(G,{"export-data":t(I)},null,8,["export-data"])]),a("div",ye,[l(P,{modelValue:t(c),"onUpdate:modelValue":s[1]||(s[1]=n=>$(c)?c.value=n:null),clearable:"",placeholder:"Search..."},null,8,["modelValue"])])])]),l(pe,{modelValue:t(o),"onUpdate:modelValue":s[2]||(s[2]=n=>$(o)?o.value=n:null),title:t(p),message:t(_),"confirm-button-text":t(D),"confirm-button-kind":t(S),onConfirm:Y,onCancel:z},null,8,["modelValue","title","message","confirm-button-text","confirm-button-kind"]),a("div",xe,[l(q,{"table-class-name":"datatable",headers:A,items:t(O),"items-selected":t(u),"onUpdate:itemsSelected":s[3]||(s[3]=n=>$(u)?u.value=n:null),alternating:"",loading:t(m),"search-field":"username","search-value":t(c)},{loading:d(()=>s[5]||(s[5]=[a("svg",{class:"w-15 h-15 text-emerald-600",width:"38",height:"38",viewBox:"0 0 38 38",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor"},[a("g",{fill:"none","fill-rule":"evenodd"},[a("g",{transform:"translate(1 1)","stroke-width":"2"},[a("circle",{"stroke-opacity":".5",cx:"18",cy:"18",r:"18"}),a("path",{d:"m36 18c0-9.94-8.06-18-18-18"},[a("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"1s",repeatCount:"indefinite"})])])])],-1)])),"item-actions":d(n=>[a("div",_e,[t(i)?(b(),C("button",{key:0,type:"button",onClick:H=>F(n),class:"cursor-pointer",title:"Edit user roles"},[l(v,{icon:"fa:edit",class:"w-5 h-5"})],8,he)):T("",!0),t(i)?(b(),C("button",{key:1,type:"button",onClick:H=>K(n),class:te([n.disabled?"text-emerald-600":"text-red-600","cursor-pointer"]),title:n.disabled?"Enable user":"Disable user"},[l(v,{icon:n.disabled?"mdi:check-circle":"mdi:block-helper",class:"w-5 h-5"},null,8,["icon"])],10,we)):T("",!0)])]),_:1},8,["items","items-selected","loading","search-value"])])])}}});export{Re as default};
