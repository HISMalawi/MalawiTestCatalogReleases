import{_ as q}from"./eA2H0pyo.js";import{_ as B}from"./WCtLych_.js";import{_ as N}from"./Cy6ejAbI.js";import{_ as C}from"./Bf0aH3QM.js";import{_ as T}from"./BgOZ5tY3.js";import{d as I,u as S,x as $,y as D,r as g,z as E,o as b,k as M,c as R,b as A,e as i,f as s,g as H,l as n}from"./DSPXqrpM.js";import{u as F}from"./BxMKpl0t.js";import{u as k}from"./CnpgD76R.js";import"./f4feb2ck.js";const L={class:"min-h-screen bg-gray-50 p-5"},P={class:"mx-auto"},j={class:"bg-white rounded-lg border border-gray-100 overflow-hidden"},z={class:"w-full py-5 px-5"},Y={class:"w-full grid grid-cols-2 gap-5"},G={class:"overflow-hidden"},te=I({__name:"[id]",setup(J){F({title:"Update Organism | Malawi Test Catalog"});const{$metadata:f,$toast:m}=S(),h=$(),c=D(),{canEdit:V}=k();V.value||(m.error("You don't have permission to edit organisms"),c.push("/app/organisms"));const u=g(!1),l=g(null),v=g([]),o=E({name:"",short_name:"",description:"",preferred_name:"",scientific_name:"",loinc_code:"",moh_code:"",nlims_code:"",id:0,created_at:"",updated_at:"",drugs:[]}),y={fields:[{name:"name",label:"Name",rules:{required:!0}},{name:"short_name",label:"Short name",rules:{required:!1}},{name:"preferred_name",label:"Preferred name",rules:{required:!0}},{name:"scientific_name",label:"Scientific name",rules:{required:!1}},{name:"loinc_code",label:"LONIC code",rules:{required:!1}},{name:"moh_code",label:"MOH code",rules:{required:!1}}]};b(async()=>{const d=h.params.id;if(!d){m.error("Invalid organism ID"),setTimeout(()=>{c.push("/app/organisms")},3e3);return}u.value=!0;try{const e=await f.organisms.getById(Number(d));l.value=e,l.value!==null&&Object.keys(o).forEach(t=>{var r,p;l.value&&t in l.value&&l.value[t]!==void 0&&(o[t]=l.value[t],o.drugs=(p=(r=l.value)==null?void 0:r.drugs)==null?void 0:p.map(_=>_.id))})}catch{m.error("Failed to fetch organism data"),setTimeout(()=>{c.push("/app/organisms")},3e3)}finally{u.value=!1}});const w=async(d,e)=>{if(!(!e||!l.value)){u.value=!0;try{const t={...l.value,...o};await f.organisms.update(t.id,t),m.success("Organism updated successfully"),setTimeout(()=>{c.push("/app/organisms")},3e3)}catch{m.error("An error occurred while updating organism")}finally{u.value=!1}}};return b(async()=>{const d=await f.drugs.getAll();v.value=d}),(d,e)=>{const t=q,r=B,p=M("RichTextEditor"),_=N,x=C,U=T;return A(),R("div",L,[i("div",P,[i("div",j,[s(t,{icon:"healthicons:virus-outline",title:"Update organism",description:"Modify details of the organism"}),i("div",z,[s(U,{config:y,onSubmit:w},{default:H(({form:O})=>[i("div",Y,[s(r,{name:"name",label:"Name",modelValue:n(o).name,"onUpdate:modelValue":e[0]||(e[0]=a=>n(o).name=a),required:""},null,8,["modelValue"]),s(r,{name:"short_name",label:"Short name",modelValue:n(o).short_name,"onUpdate:modelValue":e[1]||(e[1]=a=>n(o).short_name=a)},null,8,["modelValue"]),s(r,{name:"preferred_name",label:"Preferred name",modelValue:n(o).preferred_name,"onUpdate:modelValue":e[2]||(e[2]=a=>n(o).preferred_name=a),required:""},null,8,["modelValue"]),s(r,{name:"scientific_name",label:"Scientific name",modelValue:n(o).scientific_name,"onUpdate:modelValue":e[3]||(e[3]=a=>n(o).scientific_name=a)},null,8,["modelValue"]),s(r,{name:"loinc_code",label:"LONIC code",modelValue:n(o).loinc_code,"onUpdate:modelValue":e[4]||(e[4]=a=>n(o).loinc_code=a)},null,8,["modelValue"]),s(r,{name:"moh_code",label:"MOH code",modelValue:n(o).moh_code,"onUpdate:modelValue":e[5]||(e[5]=a=>n(o).moh_code=a)},null,8,["modelValue"]),i("div",null,[e[8]||(e[8]=i("label",{for:"description",class:"block font-medium text-gray-700 mb-2"},"Description",-1)),i("div",G,[s(p,{theme:"snow",class:"editor",content:n(o).description,"onUpdate:content":e[6]||(e[6]=a=>n(o).description=a),contentType:"html"},null,8,["content"])])]),s(_,{name:"drug",label:"Drug(s)","is-multiple":"",modelValue:n(o).drugs,"onUpdate:modelValue":e[7]||(e[7]=a=>n(o).drugs=a),options:n(v).map(a=>({...a,label:a.name})),required:""},null,8,["modelValue","options"])]),s(x,{disabled:!O.isValid,class:"mt-4",label:"Update",loading:n(u),type:"submit"},null,8,["disabled","loading"])]),_:1})])])])])}}});export{te as default};
