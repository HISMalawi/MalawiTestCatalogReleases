import{_ as q}from"./DVOtJaNl.js";import{u as B,_ as $}from"./DElJMKTp.js";import{d as V,B as k,D as N,u as O,o as A,c as D,b as m,e as u,f as l,g as H,J as K,K as M,L as R,k as a,_ as j}from"./PjMfiYHK.js";import{u as F}from"./CWorKg9L.js";import"./fOVD2dkZ.js";import"./NlL6ZmLo.js";import"./Ste0I7My.js";const I={class:"min-h-screen bg-gray-50 p-5"},J={class:"mx-auto"},L={class:"bg-white rounded-lg border border-gray-100 overflow-hidden"},P=V({__name:"update",setup(z){F({title:"Update Test Type | Malawi Test Catalog"});const g=k(),r=N(),{$api:c,$toast:o}=O(),{currentStep:h,loading:i,testCatalog:d,stepStatuses:f,handleStepChange:y,getValidationErrors:b,handleSpecimenUpdate:T,handleOrganismsUpdate:S,removeNullKeys:v,getSteps:x,prepareDataForSubmission:C}=B(),p=x(),_=e=>{const s=p.find(t=>t.id===e);return s||{component:null,props:{}}},E=async()=>{await c.get(`test_types/${r.query.id}`).then(e=>{var s;e&&Object.assign(d,{test_type:{id:e.id,name:e.name,short_name:e.short_name,description:e.description,loinc_code:e.loinc_code,moh_code:e.moh_code,nlims_code:e.nlims_code,targetTAT:e.targetTAT,preferred_name:e.preferred_name,scientific_name:e.scientific_name,can_be_done_on_sex:e.can_be_done_on_sex,test_category_id:((s=e.test_category)==null?void 0:s.id)||0,prevalence_threshold:e.prevalence_threshold,created_at:e.created_at,updated_at:e.updated_at,assay_format:e.assay_format,hr_cadre_required:e.hr_cadre_required,iblis_mapping_name:e.iblis_mapping_name},specimen_types:e.specimen_types.map(t=>t.id)||[],measures:v(e.measures)||[],organisms:e.organisms||[],lab_test_sites:e.lab_test_sites.map(t=>t.id)||[],equipment:e.equipment.map(t=>t.id)||[]})}).catch(e=>{console.error(e),o.error("Error fetching test type")})},U=async()=>{i.value=!0,await c.put(`test_types/${r.query.id}`,{test_catalog:C()}).then(e=>{e&&(o.success("Test type updated successfully"),setTimeout(()=>{g.push("/app/test-types")},2e3))}).catch(e=>{o.error("Error updating test type"),console.error("Error updating test type:",e)}).finally(()=>{i.value=!1})};return A(()=>{E()}),(e,s)=>{const t=q,w=$;return m(),D("div",I,[u("div",J,[u("div",L,[l(t,{icon:"healthicons:test-tubes-outline",title:"Update Test Type",description:"Edit test type with associated measures and specifications"}),l(w,{steps:a(p),"initial-step":a(h),onValidationErrors:a(b),"step-statuses":a(f),onStepChanged:a(y),onSubmit:U,data:a(d),submitting:a(i)},{default:H(({currentStep:n})=>[(m(),K(M(_(n).component),R(_(n).props,{ref:`stepper-current-${n}`,"onUpdate:selectedSpecimens":a(T),"onUpdate:selectedOrganisms":a(S)}),null,16,["onUpdate:selectedSpecimens","onUpdate:selectedOrganisms"]))]),_:1},8,["steps","initial-step","onValidationErrors","step-statuses","onStepChanged","data","submitting"])])])])}}}),te=j(P,[["__scopeId","data-v-b17bddfe"]]);export{te as default};
