import{_ as $}from"./DVOtJaNl.js";import{_ as x}from"./BXFRxcxa.js";import{_ as C}from"./fOVD2dkZ.js";import{_ as T}from"./NlL6ZmLo.js";import{d as F,u as L,q as I,s as A,r as p,v as E,o as M,c as k,b as H,e as c,f as t,g as R,k as s}from"./PjMfiYHK.js";import{u as S}from"./CWorKg9L.js";import"./Ste0I7My.js";const j={class:"min-h-screen bg-gray-50 p-5"},D={class:"mx-auto"},O={class:"bg-white rounded-lg border border-gray-100 overflow-hidden"},z={class:"w-full py-5 px-5"},G={class:"w-full grid grid-cols-2 gap-5"},re=F({__name:"[id]",setup(J){S({title:"Update User | Malawi Test Catalog"});const{$metadata:f,$toast:m,$api:b}=L(),U=I(),_=A(),d=p(!1),w=p(!1),n=p(""),l=p(null),v=p("");let g;const e=E({username:"",app_name:"",partner:"",location:"",password:"",password_confirmation:"",id:0,created_at:"",updated_at:""}),V={fields:[{name:"username",label:"Username",rules:{required:!0,minLength:4}},{name:"app_name",label:"Full Name",rules:{required:!0}},{name:"partner",label:"Partner",rules:{required:!0}},{name:"location",label:"Location",rules:{required:!1}},{name:"password",label:"New Password",rules:{required:!1,minLength:6}},{name:"password_confirmation",label:"Confirm New Password",rules:{required:!1,minLength:6}}]},h=async()=>{const u=U.params.id;if(u){d.value=!0;try{const a=await f.users.getById(Number(u));l.value=a,v.value=a.username,l.value!==null&&Object.keys(e).forEach(r=>{l.value&&r in l.value&&l.value[r]!==void 0&&r!=="password"&&r!=="password_confirmation"&&(e[r]=l.value[r])})}catch{m.error("Failed to fetch user data"),setTimeout(()=>{_.push("/app/users")},3e3)}finally{d.value=!1}}},y=()=>{clearTimeout(g),n.value="",g=setTimeout(()=>{q()},1e3)},q=async()=>{if(e.username===v.value){n.value="";return}if(!e.username||e.username.trim()===""||e.username.length<4){n.value="";return}w.value=!0,n.value="";try{const u=await b.get(`users/check_username/${e.username}`);n.value=""}catch(u){u.status===422&&(n.value=u.data.message)}finally{w.value=!1}},N=async(u,a)=>{if(n.value){m.error("Please fix username error before submitting");return}if(!(!a||!l.value)){if(e.password&&e.password!==e.password_confirmation){m.error("Passwords do not match");return}d.value=!0;try{const r={...l.value,...e};e.password||(delete r.password,delete r.password_confirmation),await f.users.update(r.id,r),m.success("User updated successfully"),setTimeout(()=>{_.push("/app/users")},2e3)}catch{m.error("An error occurred while updating user")}finally{d.value=!1}}};return M(h),(u,a)=>{const r=$,i=x,B=C,P=T;return H(),k("div",j,[c("div",D,[c("div",O,[t(r,{icon:"mdi:account-edit-outline",title:"Update User",description:"Modify details of the user account"}),c("div",z,[t(P,{config:V,onSubmit:N},{default:R(({form:K})=>[c("div",G,[t(i,{name:"username",label:"Username",modelValue:s(e).username,"onUpdate:modelValue":a[0]||(a[0]=o=>s(e).username=o),"error-message":s(n),required:"",onInput:y},null,8,["modelValue","error-message"]),t(i,{name:"app_name",label:"Full Name",modelValue:s(e).app_name,"onUpdate:modelValue":a[1]||(a[1]=o=>s(e).app_name=o),required:""},null,8,["modelValue"]),t(i,{name:"partner",label:"Partner",modelValue:s(e).partner,"onUpdate:modelValue":a[2]||(a[2]=o=>s(e).partner=o),required:""},null,8,["modelValue"]),t(i,{name:"location",label:"Location",modelValue:s(e).location,"onUpdate:modelValue":a[3]||(a[3]=o=>s(e).location=o)},null,8,["modelValue"]),t(i,{name:"password",label:"New Password (optional)",type:"password",modelValue:s(e).password,"onUpdate:modelValue":a[4]||(a[4]=o=>s(e).password=o)},null,8,["modelValue"]),t(i,{name:"password_confirmation",label:"Confirm New Password",type:"password",modelValue:s(e).password_confirmation,"onUpdate:modelValue":a[5]||(a[5]=o=>s(e).password_confirmation=o)},null,8,["modelValue"])]),t(B,{class:"mt-4",label:"Update",loading:s(d),type:"submit"},null,8,["loading"])]),_:1})])])])])}}});export{re as default};
