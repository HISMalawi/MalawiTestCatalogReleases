import{d as H,r as b,Q as J,m as B,o as P,w as O,_ as R,j as W,c as n,b as r,x as p,e as m,i as $,t as q,F as D,y as T,f as N,aj as M,E as X,ak as Y,A as C,al as k}from"./PjMfiYHK.js";const Z=H({name:"DropdownAutocomplete",props:{name:{required:!0,type:String},options:{type:Array,required:!0},modelValue:{type:[String,Number,Object,Array],default:null},isMultiple:{type:Boolean,default:!1},placeholder:{type:String,default:"Select an option"},id:{type:String,default:()=>`dropdown-${Math.random().toString(36).substr(2,9)}`},required:{type:Boolean,required:!1,default:!1},label:{type:String,required:!1},errorMessage:{type:String,required:!1},validateOnBlur:{type:Boolean,default:!0},validateOnChange:{type:Boolean,default:!1},validateOnMount:{type:Boolean,default:!1},rules:{type:Object,required:!1},hideNotSelected:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:modelValue","change","validated","blur","focus"],setup(e,{emit:a}){const f=b(!1),d=b(""),s=b(-1),c=b(null),o=b([]),t=b(void 0),y=b(!1),u=J("formContext",null),S=B(()=>s.value>=0&&s.value<h.value.length),V=()=>{if(e.modelValue!==0&&e.modelValue!==""){if(e.isMultiple&&Array.isArray(e.modelValue)){const l=e.modelValue.map(i=>String(i));o.value=e.options.filter(i=>l.includes(String(i.id)))}else if(!e.isMultiple){const l=e.options.find(i=>String(i.id)===String(e.modelValue));l&&(c.value=l,d.value=l.label)}}if(u&&u.formValues[e.name]!==void 0){if(e.isMultiple&&Array.isArray(u.formValues[e.name])){const l=u.formValues[e.name].map(i=>String(i));o.value=e.options.filter(i=>l.includes(String(i.id)))}else if(!e.isMultiple){const l=e.options.find(i=>String(i.id)===String(u.formValues[e.name]));l&&(c.value=l,d.value=l.label)}}};P(()=>{V(),e.validateOnMount&&w()}),O(()=>e.options,()=>{V()},{deep:!0});const h=B(()=>{let l=e.options;if(d.value&&(l=l.filter(i=>i.label.toLowerCase().includes(d.value.toLowerCase()))),e.hideNotSelected){const i=o.value.map(v=>String(v.id));l=l.filter(v=>!i.includes(String(v.id)))}return l}),F=()=>{f.value=!f.value,f.value&&(s.value=-1)},A=()=>{setTimeout(()=>{f.value=!1,e.isMultiple?d.value="":c.value||(d.value=""),s.value=-1},150)},j=()=>{f.value=!0},z=()=>{y.value=!0,a("blur"),e.validateOnBlur&&w(),A()},L=()=>{f.value=!0,a("focus"),w()},E=l=>{if(!f.value)return f.value=!0;h.value.length!==0&&(l==="down"?s.value<h.value.length-1?s.value++:s.value=0:s.value>0?s.value--:s.value=h.value.length-1)},Q=()=>{S.value&&I(s.value)},w=()=>{let l;return e.required&&(e.isMultiple&&o.value.length===0?l={type:"required",message:e.errorMessage||"This field is required"}:!e.isMultiple&&!c.value&&(l={type:"required",message:e.errorMessage||"This field is required"})),t.value=l,a("validated",l),!t.value},I=l=>{var v;if(l<0||l>=h.value.length)return;const i=h.value[l];e.isMultiple?(o.value.some(g=>g.id===i.id)||o.value.push(i),d.value="",a("update:modelValue",o.value.map(g=>g.id))):(c.value=i,d.value=i.label,a("update:modelValue",i.id)),((v=t.value)==null?void 0:v.type)==="required"&&(t.value=void 0,a("validated",void 0)),a("change",i),e.isMultiple||(f.value=!1),s.value=-1},K=l=>{o.value.splice(l,1),a("update:modelValue",o.value.map(i=>i.id)),e.required&&o.value.length===0?(t.value={type:"required",message:e.errorMessage||"This field is required"},a("validated",t.value)):e.validateOnChange&&w()},U=l=>o.value.some(i=>String(i.id)===String(l.id)),G=B(()=>{var l;return((l=t.value)==null?void 0:l.message)||""});return O(()=>e.modelValue,l=>{var i;if(l!==null){if(e.isMultiple&&Array.isArray(l)){const v=l.map(g=>String(g));o.value=e.options.filter(g=>v.includes(String(g.id)))}else if(!e.isMultiple){const v=e.options.find(g=>String(g.id)===String(l));v&&(c.value=v,d.value=v.label)}}else e.isMultiple?o.value=[]:(c.value=null,d.value="");u&&(u.formValues[e.name]=l),((i=t.value)==null?void 0:i.type)==="required"&&(e.isMultiple&&Array.isArray(l)&&l.length>0||!e.isMultiple&&l!==null&&l!==void 0)&&(t.value=void 0,a("validated",void 0))},{deep:!0}),O(()=>u==null?void 0:u.formErrors[e.name],l=>{t.value=l},{immediate:!0}),O(()=>e.errorMessage,l=>{var i;l&&!t.value?t.value={type:"custom",message:l}:!l&&((i=t.value)==null?void 0:i.type)==="custom"&&(t.value=void 0)},{immediate:!0}),O(()=>c.value,l=>{var i;l&&((i=t.value)==null?void 0:i.type)==="required"&&(t.value=void 0,a("validated",void 0))}),O(()=>o.value.length,l=>{var i;l>0&&((i=t.value)==null?void 0:i.type)==="required"&&(t.value=void 0,a("validated",void 0))}),{isOpen:f,error:t,searchQuery:d,activeOptionIndex:s,selectedOption:c,selectedOptions:o,filteredOptions:h,errorToDisplay:G,toggleDropdown:F,closeDropdown:A,handleInput:j,navigateOptions:E,selectOption:I,removeOption:K,isSelected:U,handleBlur:z,handleFocus:L,validate:w,hasActiveOption:S,selectCurrentOption:Q}}}),x={class:"w-full relative flex flex-col gap-1.5"},_=["for"],ee={key:0,class:"text-red-500"},le={key:1,class:"flex flex-wrap gap-2 mb-1"},te=["onClick"],ie={class:"relative"},ae=["placeholder","id","aria-invalid","aria-errormessage"],oe={key:0,class:"absolute right-2 top-1/2 -translate-y-1/2"},ne=["id"],re={class:"text-sm text-red-600"},se={key:3,class:"absolute z-10 w-full bg-white rounded-md shadow-lg max-h-60 overflow-auto mt-1",style:{top:"55%","margin-top":"2rem"}},ue={class:"py-1"},de={key:0,class:"px-4 py-2 text-gray-500"},ve={key:1,class:"px-4 py-2 text-emerald-600 bg-emerald-50 font-medium"},fe=["onMousedown","onMouseover"],me={key:0,class:"ml-auto text-emerald-600 flex items-center space-x-2"};function ce(e,a,f,d,s,c){const o=W("Icon");return r(),n("div",x,[e.label?(r(),n("label",{key:0,for:e.id,class:"block text-base font-medium text-gray-700"},[$(q(e.label)+" ",1),e.required?(r(),n("span",ee,"*")):p("",!0)],8,_)):p("",!0),e.isMultiple&&e.selectedOptions.length?(r(),n("div",le,[(r(!0),n(D,null,T(e.selectedOptions,(t,y)=>(r(),n("div",{key:t.id,class:"flex items-center bg-emerald-100 text-emerald-700 px-2 py-1 rounded"},[$(q(t.label)+" ",1),m("button",{onClick:M(u=>e.removeOption(y),["stop"]),class:"ml-2 text-emerald-600 focus:outline-none"},[N(o,{icon:"carbon:close-filled",class:"w-4 h-4"})],8,te)]))),128))])):p("",!0),m("div",ie,[X(m("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=t=>e.searchQuery=t),onFocus:a[1]||(a[1]=(...t)=>e.handleFocus&&e.handleFocus(...t)),onBlur:a[2]||(a[2]=(...t)=>e.handleBlur&&e.handleBlur(...t)),onInput:a[3]||(a[3]=(...t)=>e.handleInput&&e.handleInput(...t)),onKeydown:[a[4]||(a[4]=k(M(t=>e.navigateOptions("down"),["prevent"]),["down"])),a[5]||(a[5]=k(M(t=>e.navigateOptions("up"),["prevent"]),["up"])),a[6]||(a[6]=k(M((...t)=>e.selectCurrentOption&&e.selectCurrentOption(...t),["prevent"]),["enter"])),a[7]||(a[7]=k(t=>e.isOpen=!1,["esc"]))],placeholder:e.placeholder,id:e.id,"aria-invalid":!!e.error,"aria-errormessage":`error-${e.id}`,class:C(["w-full px-2 py-1 border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",{"border-red-500 focus:ring-red-500 focus:border-red-500":e.error}])},null,42,ae),[[Y,e.searchQuery]]),m("button",{type:"button",onClick:a[8]||(a[8]=(...t)=>e.toggleDropdown&&e.toggleDropdown(...t)),class:"absolute inset-y-0 right-0 flex items-center px-2 text-gray-500 focus:outline-none"},[(r(),n("svg",{class:C(["w-5 h-5 transition-transform duration-200",{"rotate-180":e.isOpen}]),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},a[9]||(a[9]=[m("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]),2))]),e.loading?(r(),n("div",oe,a[10]||(a[10]=[m("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-gray-300 border-t-emerald-500"},null,-1)]))):p("",!0)]),e.errorToDisplay?(r(),n("div",{key:2,class:"flex items-center mt-1",id:`error-${e.id}`},[N(o,{icon:"circum:warning",class:"w-4 h-4 text-red-600 mr-2"}),m("p",re,q(e.errorToDisplay),1)],8,ne)):p("",!0),e.isOpen?(r(),n("div",se,[m("ul",ue,[e.filteredOptions.length===0?(r(),n("li",de," No results found ")):e.hasActiveOption?p("",!0):(r(),n("li",ve," Select an option ")),(r(!0),n(D,null,T(e.filteredOptions,(t,y)=>{var u;return r(),n("li",{key:t.id,onMousedown:M(S=>e.selectOption(y),["prevent"]),onMouseover:S=>e.activeOptionIndex=y,class:C(["px-4 py-2 cursor-pointer hover:bg-emerald-50 transition-colors duration-150 flex items-center",{"bg-emerald-100":y===e.activeOptionIndex}])},[m("span",null,q(t.label),1),(e.isMultiple?e.isSelected(t):t.id===((u=e.selectedOption)==null?void 0:u.id))?(r(),n("span",me,a[11]||(a[11]=[m("svg",{class:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[m("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]))):p("",!0)],42,fe)}),128))])])):p("",!0)])}const pe=R(Z,[["render",ce]]);export{pe as _};
