import{_ as $}from"./eA2H0pyo.js";import{u as B,_ as V}from"./DuPJTJWy.js";import{d as A,j as N,G as O,u as k,o as M,c as R,b as u,e as l,f as h,g as j,v as D,L as H,M as F,l as a,_ as G}from"./DSPXqrpM.js";import{u as I}from"./BxMKpl0t.js";import{u as K}from"./CnpgD76R.js";import"./Bf0aH3QM.js";import"./BgOZ5tY3.js";import"./f4feb2ck.js";const L={class:"min-h-screen bg-gray-50 p-5"},P={class:"mx-auto"},Y={class:"bg-white rounded-lg border border-gray-100 overflow-hidden"},z=A({__name:"update",setup(J){I({title:"Update Test Type | Malawi Test Catalog"});const r=N(),c=O(),{$api:d,$toast:o}=k(),{canEdit:g}=K();g.value||(o.error("You don't have permission to edit test types"),r.push("/app/test-types"));const{currentStep:f,loading:i,testCatalog:p,stepStatuses:y,handleStepChange:b,getValidationErrors:T,handleSpecimenUpdate:v,handleOrganismsUpdate:S,removeNullKeys:x,getSteps:C,prepareDataForSubmission:E}=B(),_=C(),m=e=>{const s=_.find(t=>t.id===e);return s||{component:null,props:{}}},U=async()=>{await d.get(`test_types/${c.query.id}`).then(e=>{var s;e&&Object.assign(p,{test_type:{id:e.id,name:e.name,short_name:e.short_name,description:e.description,loinc_code:e.loinc_code,moh_code:e.moh_code,nlims_code:e.nlims_code,targetTAT:e.targetTAT,preferred_name:e.preferred_name,scientific_name:e.scientific_name,can_be_done_on_sex:e.can_be_done_on_sex,test_category_id:((s=e.test_category)==null?void 0:s.id)||0,prevalence_threshold:e.prevalence_threshold,created_at:e.created_at,updated_at:e.updated_at,assay_format:e.assay_format,hr_cadre_required:e.hr_cadre_required,iblis_mapping_name:e.iblis_mapping_name},specimen_types:e.specimen_types.map(t=>t.id)||[],measures:x(e.measures)||[],organisms:e.organisms||[],lab_test_sites:e.lab_test_sites.map(t=>t.id)||[],equipment:e.equipment.map(t=>t.id)||[]})}).catch(e=>{console.error(e),o.error("Error fetching test type")})},w=async()=>{i.value=!0,await d.put(`test_types/${c.query.id}`,{test_catalog:E()}).then(e=>{e&&(o.success("Test type updated successfully"),setTimeout(()=>{r.push("/app/test-types")},2e3))}).catch(e=>{o.error("Error updating test type"),console.error("Error updating test type:",e)}).finally(()=>{i.value=!1})};return M(()=>{U()}),(e,s)=>{const t=$,q=V;return u(),R("div",L,[l("div",P,[l("div",Y,[h(t,{icon:"healthicons:test-tubes-outline",title:"Update Test Type",description:"Edit test type with associated measures and specifications"}),h(q,{steps:a(_),"initial-step":a(f),onValidationErrors:a(T),"step-statuses":a(y),onStepChanged:a(b),onSubmit:w,data:a(p),submitting:a(i)},{default:j(({currentStep:n})=>[(u(),D(H(m(n).component),F(m(n).props,{ref:`stepper-current-${n}`,"onUpdate:selectedSpecimens":a(v),"onUpdate:selectedOrganisms":a(S)}),null,16,["onUpdate:selectedSpecimens","onUpdate:selectedOrganisms"]))]),_:1},8,["steps","initial-step","onValidationErrors","step-statuses","onStepChanged","data","submitting"])])])])}}}),oe=G(z,[["__scopeId","data-v-a4102190"]]);export{oe as default};
