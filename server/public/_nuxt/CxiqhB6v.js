import{_ as b}from"./DVOtJaNl.js";import{_ as v}from"./fOVD2dkZ.js";import{u as T}from"./CkD7rTcS.js";import{_ as w,a as x,b as C}from"./Dfd-DQTo.js";import{d as $,B,u as E,o as N,C as S,c as U,b as q,e as r,f as n,g as A,k as a}from"./PjMfiYHK.js";import{u as D}from"./CWorKg9L.js";import"./BXFRxcxa.js";import"./CSyLZfXx.js";import"./Ste0I7My.js";const F={class:"min-h-screen bg-gray-50 p-5"},P={class:"mx-auto"},V={class:"bg-white rounded-lg border border-gray-100 overflow-hidden"},k={class:"p-6"},H={class:"space-y-8"},L={class:"flex justify-end mt-6"},X=$({__name:"create",setup(M){D({title:"Create Test Panel | Malawi Test Catalog"});const u=B(),{$metadata:m,$toast:c}=E(),p=o=>{o.detail&&o.detail.description};N(()=>{window.addEventListener("description-updated",p)}),S(()=>{window.removeEventListener("description-updated",p)});const{loading:l,testPanel:e,validationErrors:d,handleTestTypesUpdate:_,getValidationErrors:f,prepareDataForSubmission:y}=T(),h={fields:[{name:"name",label:"Name",rules:{required:!0}},{name:"short_name",label:"Short Name",rules:{required:!0}},{name:"description",label:"Description",rules:{required:!0}},{name:"test_types",label:"Test Types",rules:{custom:o=>!e.test_types||e.test_types.length===0?"At least one test type must be selected":!0}}]},g=async(o,i)=>{const t=d;if(!e.description||e.description.trim()===""?(t.description={message:"Description is required"},i=!1):t.description&&delete t.description,!e.test_types||e.test_types.length===0?(t.test_types={message:"At least one test type must be selected"},i=!1):t.test_types&&delete t.test_types,!i){console.error("Form validation failed:",d);return}e.description===null&&(e.description=""),l.value=!0;try{const s=y();await m.test_panels.create({test_panel:s})&&(c.success("Test panel created successfully"),setTimeout(()=>{u.push("/app/test-panels")},2e3))}catch(s){console.error("Error creating test panel:",s),c.error("Failed to create test panel"),s.validation&&f(s.validation)}finally{l.value=!1}};return(o,i)=>{const t=b,s=v;return q(),U("div",F,[r("div",P,[r("div",V,[n(t,{icon:"fluent:panel-left-text-20-regular",title:"Create Test Panel",description:"Add a new test panel with associated test types"}),r("div",k,[n(C,{config:h,onSubmit:g,"validate-on-submit":!0,"validate-on-change":!0,"model-value":a(e)},{default:A(()=>[r("div",H,[n(w,{"test-panel":a(e),errors:a(d)},null,8,["test-panel","errors"]),n(x,{"test-panel":a(e),"onUpdate:selectedTestTypes":a(_)},null,8,["test-panel","onUpdate:selectedTestTypes"]),r("div",L,[n(s,{type:"submit",label:"Submit",loading:a(l)},null,8,["loading"])])])]),_:1},8,["model-value"])])])])])}}});export{X as default};
