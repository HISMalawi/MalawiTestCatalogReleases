import{_ as b}from"./eA2H0pyo.js";import{_ as T}from"./Bf0aH3QM.js";import{u as w}from"./il7jLVcv.js";import{_ as E,a as x,b as $}from"./BMzqleIn.js";import{d as C,j as A,u as B,o as N,E as S,c as U,b as q,e as r,f as n,g as D,l as a}from"./DSPXqrpM.js";import{u as F}from"./BxMKpl0t.js";import{u as P}from"./CnpgD76R.js";import"./WCtLych_.js";import"./Bcsf2iPY.js";import"./f4feb2ck.js";const V={class:"min-h-screen bg-gray-50 p-5"},j={class:"mx-auto"},k={class:"bg-white rounded-lg border border-gray-100 overflow-hidden"},H={class:"p-6"},L={class:"space-y-8"},M={class:"flex justify-end mt-6"},ee=C({__name:"create",setup(R){F({title:"Create Test Panel | Malawi Test Catalog"});const p=A(),{$metadata:m,$toast:l}=B(),{canEdit:_}=P();_.value||(l.error("You don't have permission to create test panels"),p.push("/app/test-panels"));const u=o=>{o.detail&&o.detail.description};N(()=>{window.addEventListener("description-updated",u)}),S(()=>{window.removeEventListener("description-updated",u)});const{loading:d,testPanel:e,validationErrors:c,handleTestTypesUpdate:f,getValidationErrors:y,prepareDataForSubmission:h}=w(),g={fields:[{name:"name",label:"Name",rules:{required:!0}},{name:"short_name",label:"Short Name",rules:{required:!0}},{name:"description",label:"Description",rules:{required:!0}},{name:"test_types",label:"Test Types",rules:{custom:o=>!e.test_types||e.test_types.length===0?"At least one test type must be selected":!0}}]},v=async(o,i)=>{const t=c;if(!e.description||e.description.trim()===""?(t.description={message:"Description is required"},i=!1):t.description&&delete t.description,!e.test_types||e.test_types.length===0?(t.test_types={message:"At least one test type must be selected"},i=!1):t.test_types&&delete t.test_types,!i){console.error("Form validation failed:",c);return}e.description===null&&(e.description=""),d.value=!0;try{const s=h();await m.test_panels.create({test_panel:s})&&(l.success("Test panel created successfully"),setTimeout(()=>{p.push("/app/test-panels")},2e3))}catch(s){console.error("Error creating test panel:",s),l.error("Failed to create test panel"),s.validation&&y(s.validation)}finally{d.value=!1}};return(o,i)=>{const t=b,s=T;return q(),U("div",V,[r("div",j,[r("div",k,[n(t,{icon:"fluent:panel-left-text-20-regular",title:"Create Test Panel",description:"Add a new test panel with associated test types"}),r("div",H,[n($,{config:g,onSubmit:v,"validate-on-submit":!0,"validate-on-change":!0,"model-value":a(e)},{default:D(()=>[r("div",L,[n(E,{"test-panel":a(e),errors:a(c)},null,8,["test-panel","errors"]),n(x,{"test-panel":a(e),"onUpdate:selectedTestTypes":a(f)},null,8,["test-panel","onUpdate:selectedTestTypes"]),r("div",M,[n(s,{type:"submit",label:"Submit",loading:a(d)},null,8,["loading"])])])]),_:1},8,["model-value"])])])])])}}});export{ee as default};
