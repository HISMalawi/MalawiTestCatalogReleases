import{_ as x}from"./DVOtJaNl.js";import{_ as O}from"./BXFRxcxa.js";import{_ as B}from"./D9xJQhiL.js";import{_ as N}from"./fOVD2dkZ.js";import{_ as C}from"./NlL6ZmLo.js";import{d as T,u as I,q as S,s as $,r as g,v as D,o as v,j as M,c as E,b as H,e as i,f as s,g as R,k as n}from"./PjMfiYHK.js";import{u as A}from"./CWorKg9L.js";import"./Ste0I7My.js";const F={class:"min-h-screen bg-gray-50 p-5"},j={class:"mx-auto"},k={class:"bg-white rounded-lg border border-gray-100 overflow-hidden"},L={class:"w-full py-5 px-5"},P={class:"w-full grid grid-cols-2 gap-5"},z={class:"overflow-hidden"},oe=T({__name:"[id]",setup(G){A({title:"Update Organism | Malawi Test Catalog"});const{$metadata:p,$toast:u}=I(),V=S(),f=$(),m=g(!1),l=g(null),b=g([]),a=D({name:"",short_name:"",description:"",preferred_name:"",scientific_name:"",loinc_code:"",moh_code:"",nlims_code:"",id:0,created_at:"",updated_at:"",drugs:[]}),h={fields:[{name:"name",label:"Name",rules:{required:!0}},{name:"short_name",label:"Short name",rules:{required:!1}},{name:"preferred_name",label:"Preferred name",rules:{required:!0}},{name:"scientific_name",label:"Scientific name",rules:{required:!1}},{name:"loinc_code",label:"LONIC code",rules:{required:!1}},{name:"moh_code",label:"MOH code",rules:{required:!1}}]};v(async()=>{const d=V.params.id;if(!d){u.error("Invalid organism ID"),setTimeout(()=>{f.push("/app/organisms")},3e3);return}m.value=!0;try{const e=await p.organisms.getById(Number(d));l.value=e,l.value!==null&&Object.keys(a).forEach(t=>{var r,c;l.value&&t in l.value&&l.value[t]!==void 0&&(a[t]=l.value[t],a.drugs=(c=(r=l.value)==null?void 0:r.drugs)==null?void 0:c.map(_=>_.id))})}catch{u.error("Failed to fetch organism data"),setTimeout(()=>{f.push("/app/organisms")},3e3)}finally{m.value=!1}});const y=async(d,e)=>{if(!(!e||!l.value)){m.value=!0;try{const t={...l.value,...a};await p.organisms.update(t.id,t),u.success("Organism updated successfully"),setTimeout(()=>{f.push("/app/organisms")},3e3)}catch{u.error("An error occurred while updating organism")}finally{m.value=!1}}};return v(async()=>{const d=await p.drugs.getAll();b.value=d}),(d,e)=>{const t=x,r=O,c=M("RichTextEditor"),_=B,w=N,U=C;return H(),E("div",F,[i("div",j,[i("div",k,[s(t,{icon:"healthicons:virus-outline",title:"Update organism",description:"Modify details of the organism"}),i("div",L,[s(U,{config:h,onSubmit:y},{default:R(({form:q})=>[i("div",P,[s(r,{name:"name",label:"Name",modelValue:n(a).name,"onUpdate:modelValue":e[0]||(e[0]=o=>n(a).name=o),required:""},null,8,["modelValue"]),s(r,{name:"short_name",label:"Short name",modelValue:n(a).short_name,"onUpdate:modelValue":e[1]||(e[1]=o=>n(a).short_name=o)},null,8,["modelValue"]),s(r,{name:"preferred_name",label:"Preferred name",modelValue:n(a).preferred_name,"onUpdate:modelValue":e[2]||(e[2]=o=>n(a).preferred_name=o),required:""},null,8,["modelValue"]),s(r,{name:"scientific_name",label:"Scientific name",modelValue:n(a).scientific_name,"onUpdate:modelValue":e[3]||(e[3]=o=>n(a).scientific_name=o)},null,8,["modelValue"]),s(r,{name:"loinc_code",label:"LONIC code",modelValue:n(a).loinc_code,"onUpdate:modelValue":e[4]||(e[4]=o=>n(a).loinc_code=o)},null,8,["modelValue"]),s(r,{name:"moh_code",label:"MOH code",modelValue:n(a).moh_code,"onUpdate:modelValue":e[5]||(e[5]=o=>n(a).moh_code=o)},null,8,["modelValue"]),i("div",null,[e[8]||(e[8]=i("label",{for:"description",class:"block font-medium text-gray-700 mb-2"},"Description",-1)),i("div",z,[s(c,{theme:"snow",class:"editor",content:n(a).description,"onUpdate:content":e[6]||(e[6]=o=>n(a).description=o),contentType:"html"},null,8,["content"])])]),s(_,{name:"drug",label:"Drug(s)","is-multiple":"",modelValue:n(a).drugs,"onUpdate:modelValue":e[7]||(e[7]=o=>n(a).drugs=o),options:n(b).map(o=>({...o,label:o.name})),required:""},null,8,["modelValue","options"])]),s(w,{disabled:!q.isValid,class:"mt-4",label:"Update",loading:n(m),type:"submit"},null,8,["disabled","loading"])]),_:1})])])])])}}});export{oe as default};
