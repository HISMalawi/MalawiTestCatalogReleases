import{_ as N}from"./eA2H0pyo.js";import{_ as P}from"./WCtLych_.js";import{_ as F}from"./Cy6ejAbI.js";import{_ as T}from"./Bf0aH3QM.js";import{_ as k}from"./BgOZ5tY3.js";import{d as E,u as R,j as S,r as u,o as I,c as M,b as j,e as d,f as l,g as H,l as o,m as O}from"./DSPXqrpM.js";import{u as D}from"./BxMKpl0t.js";import{u as Y}from"./CnpgD76R.js";import"./f4feb2ck.js";const z={class:"bg-gray-50 p-5 min-h-screen"},G={class:"mx-auto"},J={class:"bg-white rounded-lg border border-gray-100 overflow-hidden"},K={class:"w-full py-5 px-5 overflow-visible"},Q={class:"w-full grid grid-cols-2 gap-5 overflow-visible"},ie=E({__name:"create",setup(W){D({title:"Create User | Malawi Test Catalog"});const{$metadata:p,$toast:t,$api:f}=R(),y=S(),{canManageUsers:V}=Y();V.value||(t.error("You don't have permission to create users"),y.push("/app/users"));const c=u(!1),_=u(!1),n=u("");let w;const v=u([]),g=u([]),a=u({id:0,username:"",app_name:"",email:"",partner:"",location:"",password:"",password_confirmation:"",roles:[],created_at:"",updated_at:""}),h={fields:[{name:"username",label:"Username",rules:{required:!0,minLength:4}},{name:"app_name",label:"Full Name",rules:{required:!0}},{name:"email",label:"Email",rules:{required:!0,email:!0}},{name:"partner",label:"Partner",rules:{required:!0}},{name:"location",label:"Location",rules:{required:!1}},{name:"password",label:"Password",rules:{required:!0,minLength:6}},{name:"password_confirmation",label:"Confirm Password",rules:{required:!0,minLength:6}}]},U=async(r,e)=>{if(a.value.password!==a.value.password_confirmation){t.error("Passwords do not match");return}c.value=!0;try{await p.users.create(a.value)&&(t.success("User created successfully"),setTimeout(()=>{O({path:"/app/users"})},2e3))}catch{t.error("An error occurred while creating user")}finally{c.value=!1}},q=()=>{clearTimeout(w),n.value="",w=setTimeout(()=>{A()},1e3)},A=async()=>{if(!a.value.username||a.value.username.trim()===""){n.value="";return}_.value=!0,n.value="";try{await f.get(`users/check_username/${a.value.username}`),n.value=""}catch(r){r.status===422&&(n.value=r.data.message)}finally{_.value=!1}},C=r=>r.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),B=async()=>{try{const r=await p.roles.getAll();r&&Array.isArray(r)&&(v.value=r.map(e=>{const i=typeof e=="string"?e:e.name||e.id;return{id:i,label:C(i)}}).filter(e=>e.id!=="system"&&e.id!=="admin"))}catch(r){console.error("Error fetching roles:",r),t.error("Failed to load roles")}},$=async()=>{try{const r=await f.get("users/locations/all");r&&Array.isArray(r)&&(g.value=r.map(e=>({id:e,label:e})))}catch(r){console.error("Error fetching locations:",r),t.error("Failed to load locations")}};return I(()=>{B(),$()}),(r,e)=>{const i=N,m=P,b=F,x=T,L=k;return j(),M("div",z,[d("div",G,[d("div",J,[l(i,{icon:"mdi:account-plus-outline",title:"Create New User",description:"Add details of a new user account"}),d("div",K,[l(L,{config:h,onSubmit:U},{default:H(({form:X})=>[d("div",Q,[l(m,{name:"username",label:"Username",modelValue:o(a).username,"onUpdate:modelValue":e[0]||(e[0]=s=>o(a).username=s),"error-message":o(n),required:"",onInput:q},null,8,["modelValue","error-message"]),l(m,{name:"app_name",label:"Full Name",modelValue:o(a).app_name,"onUpdate:modelValue":e[1]||(e[1]=s=>o(a).app_name=s),required:""},null,8,["modelValue"]),l(m,{name:"partner",label:"Partner",modelValue:o(a).partner,"onUpdate:modelValue":e[2]||(e[2]=s=>o(a).partner=s),required:""},null,8,["modelValue"]),l(b,{name:"location",label:"Location",options:o(g),modelValue:o(a).location,"onUpdate:modelValue":e[3]||(e[3]=s=>o(a).location=s),placeholder:"Select location",required:""},null,8,["options","modelValue"]),l(b,{name:"roles",label:"Roles",options:o(v),modelValue:o(a).roles,"onUpdate:modelValue":e[4]||(e[4]=s=>o(a).roles=s),"is-multiple":!0,placeholder:"Select roles",required:""},null,8,["options","modelValue"]),l(m,{name:"password",label:"Password",type:"password",modelValue:o(a).password,"onUpdate:modelValue":e[5]||(e[5]=s=>o(a).password=s),required:""},null,8,["modelValue"]),l(m,{name:"password_confirmation",label:"Confirm Password",type:"password",modelValue:o(a).password_confirmation,"onUpdate:modelValue":e[6]||(e[6]=s=>o(a).password_confirmation=s),required:""},null,8,["modelValue"])]),l(x,{class:"mt-4",label:"Submit",loading:o(c),type:"submit"},null,8,["loading"])]),_:1})])])])])}}});export{ie as default};
