import{_ as w}from"./DVOtJaNl.js";import{_ as x}from"./fOVD2dkZ.js";import{u as B}from"./CkD7rTcS.js";import{_ as E,a as U,b as $}from"./Dfd-DQTo.js";import{d as D,B as F,D as N,u as q,o as m,C,c as P,b as S,e as i,f as l,g as V,k as n}from"./PjMfiYHK.js";import{u as k}from"./CWorKg9L.js";import"./BXFRxcxa.js";import"./CSyLZfXx.js";import"./Ste0I7My.js";const A={class:"min-h-screen bg-gray-50 p-5"},j={class:"mx-auto"},H={class:"bg-white rounded-lg border border-gray-100 overflow-hidden"},I={class:"p-6"},L={class:"space-y-8"},M={class:"flex justify-end mt-6"},ee=D({__name:"update",setup(R){k({title:"Update Test Panel | Malawi Test Catalog"});const _=F(),f=N(),{$toast:d,$metadata:c}=q(),u=t=>{t.detail&&t.detail.description!==void 0&&(e.description=t.detail.description)};m(()=>{window.addEventListener("description-updated",u)}),C(()=>{window.removeEventListener("description-updated",u)});const{loading:r,testPanel:e,validationErrors:p,handleTestTypesUpdate:y,getValidationErrors:h,prepareDataForSubmission:g}=B(),b={fields:[{name:"name",label:"Name",rules:{required:!0}},{name:"short_name",label:"Short Name",rules:{required:!0}},{name:"description",label:"Description",rules:{required:!0}},{name:"test_types",label:"Test Types",rules:{custom:t=>!e.test_types||e.test_types.length===0?"At least one test type must be selected":!0}}]},v=async()=>{r.value=!0;try{const t=f.query.id;if(!t){d.error("Test panel ID is missing");return}const a=await c.test_panels.getById(Number(t));if(a){const s=a.test_types?a.test_types.map(o=>o.id):[];Object.assign(e,{...a,test_types:s})}}catch(t){console.error("Failed to fetch test panel:",t),d.error("Failed to fetch test panel")}finally{r.value=!1}},T=async(t,a)=>{const s=p;if(!e.description||e.description.trim()===""?(s.description={message:"Description is required"},a=!1):s.description&&delete s.description,!e.test_types||e.test_types.length===0?(s.test_types={message:"At least one test type must be selected"},a=!1):s.test_types&&delete s.test_types,!a){console.error("Form validation failed:",p);return}e.description===null&&(e.description=""),r.value=!0;try{const o=g();await c.test_panels.update(e.id,{test_panel:o})&&(d.success("Test panel updated successfully"),setTimeout(()=>{_.push("/app/test-panels")},2e3))}catch(o){console.error("Error updating test panel:",o),d.error("Failed to update test panel"),o.validation&&h(o.validation)}finally{r.value=!1}};return m(v),(t,a)=>{const s=w,o=x;return S(),P("div",A,[i("div",j,[i("div",H,[l(s,{icon:"fluent:panel-left-text-20-regular",title:"Update Test Panel",description:"Edit test panel with associated test types"}),i("div",I,[l($,{config:b,onSubmit:T,"validate-on-submit":!0,"validate-on-change":!0,"model-value":n(e)},{default:V(()=>[i("div",L,[l(E,{"test-panel":n(e),errors:n(p)},null,8,["test-panel","errors"]),l(U,{"test-panel":n(e),"onUpdate:selectedTestTypes":n(y)},null,8,["test-panel","onUpdate:selectedTestTypes"]),i("div",M,[l(o,{type:"submit",label:"Submit",loading:n(r)},null,8,["loading"])])])]),_:1},8,["model-value"])])])])])}}});export{ee as default};
